%%  地球流体電脳倶楽部 LaTeX2e 用クラス version 7 (dennou777) %%
%%       パッケージマニュアル
%%
%% This is file `dennou777.tex'
%%
%%       Auther: Hitomi-san (a.k.a. Carele Smith)
%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\documentclass[report,notitlepage]{dennou777}

\makeatletter\ifx\dsss@engine l\relax
		\usepackage[jfm_yoko=jlreq,jfm_tate=jlreqv,]{luatexja-preset}
	\else
		\usepackage{otf}
\fi\makeatother
\usepackage{shortvrb,bxtexlogo,tgheros,newpxtext,newpxmath,listings}
\usepackage[unicode=true,colorlinks]{hyperref}
\hypersetup{linkcolor=blue,urlcolor=teal}
\usepackage[scaled]{beramono}
\MakeShortVerb{\|}
\renewcommand{\thefootnote}{\textasteriskcentered\arabic{footnote}}
\lstset{
	basicstyle=\ttfamily,
	numbers=left,
	breaklines=true,
	breakatwhitespace=false,
	frame=leftline,
	backgroundcolor={\color[gray]{.85}},
	numberstyle=\ttfamily\small,
}

\newcommand{\vseven}{Nicole}\newcommand{\dversion}{version 7.0.3 }
\newcommand{\vsevenfull}{地球流体電脳倶楽部 \LaTeXe 用クラス \dversion (\vseven)}
\newcommand{\textcode}[1]{{\ttfamily\mdseries #1}}

\Dtitle[地球流体電脳倶楽部 \LaTeXe 用クラス \dversion (\vseven)]
	{地球流体電脳倶楽部 \LaTeXe 用クラス\\ \dversion (\vseven)\\ |dennou777.cls|}
\Dauthor[dennou777 Developing Team]
	{dennou777 Developing Team\\（ひとみさん）}
\Ddate{\today}

\begin{document}

\maketitle
\thispagestyle{DAheadings}

{\noindent\hfill\bfseries\sffamily Dennou6.sty のマニュアルより\hfill}

{\small Dennou6 \LaTeX スタイルは, \LaTeX を用いた, マニュアル, 論文等の作成に便利な,
マクロ定義 スタイルファイル集である.} %原文ママ

\noindent\hrulefill

|dennou777.cls| \dversion (\vseven) は開発版であり、\emph{未完成です}。
それゆえ、このドキュメントも未完成です。開発の協力は常に歓迎しています。
GitHub リポジトリは、\url{https://github.com/Hitomi-San/dennou777} です。

\tableofcontents
\pagebreak

\chapter{インストール}

\today 現在の |dennou777.cls| \dversion (\vseven) の動作に必要なファイルは、
|dennou777.cls|、|d777helper.sty|、そして |Dennnou6.sty| に付属するファイル
（GitHub リポジトリでは、d6styles の配下にある）一式である。これらのファイル（と
このドキュメント）を「\TeX から見える位置」に配置することで、インストールは完了する。

\chapter{Dennou6.sty との相違点}

前身である |Dennnou6.sty| （以下 Version 6）との相違点を述べる。
これは、|dennou777.cls| \dversion (\vseven) （以下\vseven）が開発段階であるため、
\emph{|dennou6.sty| の利用者に積極的に利用してもらい}、不具合を取り除いたり、
機能を追加したりするのを、迅速に行いたいためである。

\vseven は、 Version 6 で提供されていた主なマクロがそのまま
使えるように配慮されている（開発者から見て、使用が推奨できないマクロは除く）。
したがって、以下に示すとおりにプリアンブルを書き換えるだけで、以前の \TeX ソース
をコンパイルできるようになるはずである。

不具合を発見したり、機能改修の要望があれば、是非 GitHub に issue として
投げて頂きたい。

\section{クラスファイルとして提供されるようになった}

\vseven はクラスファイル (.cls) として提供される。これは、Version 6 の
マクロ集が、全てスタイルファイル (.sty) として提供されていたことと対称的である。

クラスファイルとして提供されるので、Version 6 を使っていた文書で
\vseven を読み込むためには、|\documentclass| で |dennou777| を読み込み
（必要に応じてクラスオプションも書き換え\footnote{\ref{classoption}節を参照すること。}）、
|\usepackage{Dennou6}| を削除するだけで、基本的に動くはずである
\footnote{従来プリアンブルに書かれていた、「章を変えるときに改ページをしない」ための
コードなどがあると、エラーが発生する。なお、章見出しは成り行きで表示されるように、
クラスファイル内で再定義してある}。

|dennou777.cls| は jlreq \footnote{\url{https://github.com/abenori/jlreq}}
をベースに開発している。したがって、\emph{以前の jreport.cls を読み込んで、
|dennou6.sty| を読み込む方法とは、組版の結果が変わる}。

\begin{figure}[t]
\begin{lstlisting}[caption={最小のソース}]
\documentclass{dennou777}
\begin{document}
Happy, \TeX ing は猫である。
\end{document}
\end{lstlisting}
\end{figure}

\subsection{クラスオプション\label{classoption}}

先述の通り、jlreq をベースに開発しているので、jlreq に渡すことの
できるオプションはすべて受け付ける。すなわち、jlreq のドキュメント
\footnote{ターミナル上で |texdoc jlreq| を実行すると読むことができる。}
を読んでもらいたいのだが、Version 6 から\vseven に移行するにあたって、
特に必要そうなオプションを以下に挙げる。

\begin{description}
\item[paper]
	|paper=a4| で紙面のサイズが A4 版になる。a4 以外にも、a0 から a10、
	b0 から b10 などが指定できる。
\item[jafontsize]
	|jafontsize=12pt| で和文のフォントサイズが 12 pt になる。
\item[report]
	jreport 相当のクラスとなる。
\item[book]
	jbook 相当のクラスとなる。
\end{description}

すなわち、
\[\mbox{\ttfamily \textbackslash documentclass[a4j,12pt]\{jreport\}}\]
という宣言があるファイルは、その宣言を
\[\mbox{\ttfamily \textbackslash documentclass[paper=a4,jfontsize=12pt,report]\{dennou777\}}\]
と書き換えることによって（そして |\usepackage{Dennou6}| を削除すると）、
\vseven を適用させることができる。

\subsection{\LuaLaTeX や\upLaTeX に対応した}

jlreq が\LuaLaTeX や\upLaTeX に対応しているように、
\vseven は\LuaLaTeX や\upLaTeX に対応している。
.tex ソースを一切書き換えることなく、\pLaTeX、\upLaTeX、\LuaLaTeX のいずれでも
処理ができる文書を作ることができる。なお、\pLaTeX や\upLaTeX で処理をする場合、
dvi ウェアにはdvipdfmx を用いる前提となっている。

\section{graphicx と xcolor の自動読み込み}

ソースを書き換えずに3つのエンジンで処理が可能になるようにするため、\vseven は処理を
するエンジンを自動判定して、\pLaTeX か\upLaTeX で処理をしていると判断した場合、
dvipdfmx オプションをグローバルオプションに追加する\footnote{BXdvidriver パッケージを利用している}。
したがって、\vseven のオプションには（例え dvi ウェアに dvipdfmx を使用すると
しても）、\emph{|dvipdfmx| オプションをつける必要はない}\footnote{むしろ、|dvipdfmx|
オプションをつけると、その文書を\LuaLaTeX で処理すると（当然だが）正常に処理ができない。}。

\section{削除した機能}

Version 6 が提供していた機能のうち、outdated な機能は削除した。

\subsection{D6graphicx}

今どき PostScript ファイルを直接埋め込む需要がないだろうし、内部で graphicx を
（変なオプションをつけて）読み込んでいるので、すべて削除した。

D6graphicx に相当する機能は、graphicx のマクロを直接利用したり、\TikZ を利用する
などして扱うべきである。

\section{改修せずに利用している機能}

Version 6 が提供していたパッケージのうち、以下のものは（まだ手をつけられて
いないので）、改修せず、そのままの形で利用している。

\begin{itemize}
\item D6misc
\item D6version
\item D6math
\item D6float
\item D6prog
\item D6select
\end{itemize}


\chapter{コマンド群}

以下、\vseven に実装されているコマンド群について解説する。

\vseven はクラスファイル本体と、クラスファイル内で読み込まれるいくつかのパッケージで
構成されており、\vseven 本体を利用しなくても、クラスファイル内で読み込まれるパッケージ群
を読み込むことができる。

\section{dennnou777.cls}

旧来の |D6style.sty| 相当のマクロは、 |dennnou777.cls| に収められている。

\subsection{chapter 命令}

|\||chapter| 命令は、改ページがなされないように書き換えられている。
改ページを伴う章番号は、|\chapterwhithbreak| で利用することができる。

\subsection{ノンブルのスタイル}

クラスオプションでノンブルのスタイル（アラビア数字か、ローマ数字か）を変更する
ことができる。デフォルトでは、ノンブルはアラビア数字であるが、|roman_nombre| を
クラスオプションに指定すると、ノンブルがローマ数字で表示されるようになる。

\subsection{Dtitle, Dauthor, Ddate 命令}

|\Dtitle|、|\Dauthor|、|\Ddate| 命令は、ぞれぞれ |\title|、|\author|、|\date| 命令と
同様な使い方をする。|\Dtitle|、|\Dauthor|、|\Ddate| を利用すると、\vseven で定義
しているページスタイルの、ヘッダーやフッターにタイトルや著者などが表示される。

例えば、|\Dtitle[短縮名]{タイトル}| とプリアンブルで指定すると、|\maketitle| で
表示されるタイトルに |タイトル| が表示され、各ページのヘッダーには |短縮名| が
表示される。|\Dauthor| も同様である。

|\Ddate| は、指定しなければ、コンパイルした日付がタイトルページとフッターに表示される。

\subsection{Dpath, Dfile, Dfinp 命令}

|\Dpath|、|\Dfile|、|\Dfinp| 命令は、それぞれ、ファイルパス、ファイル名、
取り込みファイル名を指定する\footnote{取り込みファイル名とは何かわからなかったが、
version 6 に実装されていた機能なので、そのまま実装した}。|\Dtitle| などと同様の
使い方をし、指定したファイル名などはフッターに表示される。

|\Dfile| でファイル名を指定しなかった場合、コンパイルしたファイル名のベース名に .tex
を付け加えたものがフッターに表示される。

\subsection{DAheadings ページスタイル}

Version 6 で定義されていた、電脳標準スタイルを模したページスタイルである。

現在、ヘッダーやフッターに罫線を表示できない状態である。これは、jlreq を元に
してページスタイルを作っていることに起因している。jlreq の機能を利用して、DAheadings を
作成しているのだが、jlreq ではヘッダーやフッターに罫線が入ったページスタイルを作成
ができないためである。

\section{d777helper.sty}

ドライバ非依存のマクロ集である。文書の中で利用されることは想定していない。

\subsection{\textbackslash dsss@helper@guessengine 命令}

この命令を実行すると、ドライバを推定して、ドライバの種類を |\dsss@result| に格納する。
\LuaLaTeX であれば |l|、\pLaTeX であれば |p|、\upLaTeX であれば |u| （それぞれ文字トークン）
が格納される。これは、|d777helper.sty| を読み込んだ時点で、自動に実行される。

\subsection{暗黙の空白トークン}

|\dsss@space| が暗黙の空白トークンとして定義される。

\section{d777autoload.sty}

頻繁に利用するパッケージを、自動的に読み込むパッケージである。
|d777autoload.sty| が自動で読み込むパッケージは以下の通り。

\begin{itemize}
\item graphicx
\item xcolor
\end{itemize}

\pagebreak
\appendix
\chapter{ライセンス}

\vsevenfull は、Version 6 と同じく、修正 BSD ライセンスでの配布を行う。

This package is distributed under the Revised BSD License.

\noindent\hspace{1cm}\dotfill\hspace{1cm}

{\small
\textbf{Copyright (c) 2019, dennou777 Developing Team (Hitomi-san)
All rights reserved.}

Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions are met:
\begin{itemize}
\item Redistributions of source code must retain the above copyright notice, 
	this list of conditions and the following disclaimer.
\item Redistributions in binary form must reproduce the above copyright notice, 
	this list of conditions and the following disclaimer in the documentation 
	and/or other materials provided with the distribution.
\item Neither the name of the dennou777 Developing Team nor the names of its contributors 
	may be used to endorse or promote products derived from this software 
	without specific prior written permission.
\end{itemize}

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
DISCLAIMED. IN NO EVENT SHALL HITOMI-SAN BE LIABLE FOR ANY
DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
(INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
}

\chapter{Change log}

\begin{description}
\item[{[2019-06-04 Version 7.0.4]}] ヘッダー・フッターの不具合を修正。
\item[{[2019-05-16 Version 7.0.3]}] 全体的に表記を修正。
\item[{[2019-05-16 Version 7.0.3]}] ドキュメントに、改修していない Version 6 のパッケージを明記。
\item[{[2019-05-15 Version 7.0.2]}] ライセンスを明記。
\end{description}


\end{document}
